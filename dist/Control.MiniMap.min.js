!function(a,b){"function"==typeof define&&define.amd?define(["leaflet"],a):"object"==typeof exports&&(module.exports=a(require("leaflet"))),"undefined"!=typeof b&&b.L&&(b.L.Control.MiniMap=a(L),b.L.control.minimap=function(a,c){return new b.L.Control.MiniMap(a,c)})}(function(a){var b=a.Control.extend({options:{position:"bottomright",toggleDisplay:!1,zoomLevelOffset:-5,zoomLevelFixed:!1,centerFixed:!1,zoomAnimation:!1,autoToggleDisplay:!1,minimized:!1,width:150,height:150,collapsedWidth:19,collapsedHeight:19,aimingRectOptions:{color:"#ff7800",weight:1,clickable:!1},shadowRectOptions:{color:"#000000",weight:1,clickable:!1,opacity:0,fillOpacity:0},strings:{hideText:"Hide MiniMap",showText:"Show MiniMap"},mapOptions:{}},initialize:function(b,c){a.Util.setOptions(this,c),this.options.aimingRectOptions.clickable=!1,this.options.shadowRectOptions.clickable=!1,this._layer=b},onAdd:function(b){this._mainMap=b,this.options.centerFixed=this._mainMap.getCenter(),this._container=a.DomUtil.create("div","leaflet-control-minimap"),this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",a.DomEvent.disableClickPropagation(this._container),a.DomEvent.on(this._container,"mousewheel",a.DomEvent.stopPropagation);var c={attributionControl:!1,dragging:!this.options.centerFixed,zoomControl:!1,zoomAnimation:this.options.zoomAnimation,autoToggleDisplay:this.options.autoToggleDisplay,touchZoom:!this.options.centerFixed&&!this._isZoomLevelFixed(),scrollWheelZoom:!this.options.centerFixed&&!this._isZoomLevelFixed(),doubleClickZoom:!this.options.centerFixed&&!this._isZoomLevelFixed(),boxZoom:!this._isZoomLevelFixed(),crs:b.options.crs};return c=a.Util.extend(this.options.mapOptions,c),this._miniMap=new a.Map(this._container,c),this._miniMap.addLayer(this._layer),this._mainMapMoving=!1,this._miniMapMoving=!1,this._userToggledDisplay=!1,this._minimized=!1,this.options.toggleDisplay&&this._addToggleButton(),this._miniMap.whenReady(a.Util.bind(function(){this._aimingRect=a.rectangle(this._mainMap.getBounds(),this.options.aimingRectOptions).addTo(this._miniMap),this._shadowRect=a.rectangle(this._mainMap.getBounds(),this.options.shadowRectOptions).addTo(this._miniMap),this._mainMap.on("moveend",this._onMainMapMoved,this),this._mainMap.on("move",this._onMainMapMoving,this);var b=this,c=!1;$(this._miniMap._container).on("click",function(a){b._mainMap.setView({lat:b._miniMap.mouseEventToLatLng(a).lat,lng:b._miniMap.mouseEventToLatLng(a).lng},b._decideZoom(!1))}),$(this._miniMap._container).mousedown(function(){c=!0}),$(this._miniMap._container).mouseup(function(){c=!1,b._shadowRect.setStyle({opacity:0,fillOpacity:0})}),$(this._miniMap._container).mousemove(function(d){c&&(b._shadowRect.setBounds(new a.LatLngBounds({lat:b._miniMap.mouseEventToLatLng(d).lat+(b._aimingRect.getBounds().getSouthWest().lat-b._aimingRect.getBounds().getNorthEast().lat)/2,lng:b._miniMap.mouseEventToLatLng(d).lng+(b._aimingRect.getBounds().getSouthWest().lng-b._aimingRect.getBounds().getNorthEast().lng)/2},{lat:b._miniMap.mouseEventToLatLng(d).lat+(b._aimingRect.getBounds().getNorthEast().lat-b._aimingRect.getBounds().getSouthWest().lat)/2,lng:b._miniMap.mouseEventToLatLng(d).lng+(b._aimingRect.getBounds().getNorthEast().lng-b._aimingRect.getBounds().getSouthWest().lng)/2})),b._shadowRect.setStyle({opacity:1,fillOpacity:.3}))})},this)),this._container},addTo:function(b){a.Control.prototype.addTo.call(this,b);var c=this.options.centerFixed||this._mainMap.getCenter();return this._miniMap.setView(c,this._decideZoom(!0)),this._setDisplay(this.options.minimized),this},onRemove:function(a){this._mainMap.off("moveend",this._onMainMapMoved,this),this._mainMap.off("move",this._onMainMapMoving,this),this._miniMap.off("moveend",this._onMiniMapMoved,this),this._miniMap.removeLayer(this._layer)},changeLayer:function(a){this._miniMap.removeLayer(this._layer),this._layer=a,this._miniMap.addLayer(this._layer)},_addToggleButton:function(){this._toggleDisplayButton=this.options.toggleDisplay?this._createButton("",this._toggleButtonInitialTitleText(),"leaflet-control-minimap-toggle-display leaflet-control-minimap-toggle-display-"+this.options.position,this._container,this._toggleDisplayButtonClicked,this):void 0,this._toggleDisplayButton.style.width=this.options.collapsedWidth+"px",this._toggleDisplayButton.style.height=this.options.collapsedHeight+"px"},_toggleButtonInitialTitleText:function(){return this.options.minimized?this.options.strings.showText:this.options.strings.hideText},_createButton:function(b,c,d,e,f,g){var h=a.DomUtil.create("a",d,e);h.innerHTML=b,h.href="#",h.title=c;var i=a.DomEvent.stopPropagation;return a.DomEvent.on(h,"click",i).on(h,"mousedown",i).on(h,"dblclick",i).on(h,"click",a.DomEvent.preventDefault).on(h,"click",f,g),h},_toggleDisplayButtonClicked:function(){this._userToggledDisplay=!0,this._minimized?this._restore():this._minimize()},_setDisplay:function(a){a!==this._minimized&&(this._minimized?this._restore():this._minimize())},_minimize:function(){this.options.toggleDisplay?(this._container.style.width=this.options.collapsedWidth+"px",this._container.style.height=this.options.collapsedHeight+"px",this._toggleDisplayButton.className+=" minimized-"+this.options.position,this._toggleDisplayButton.title=this.options.strings.showText):this._container.style.display="none",this._minimized=!0},_restore:function(){this.options.toggleDisplay?(this._container.style.width=this.options.width+"px",this._container.style.height=this.options.height+"px",this._toggleDisplayButton.className=this._toggleDisplayButton.className.replace("minimized-"+this.options.position,""),this._toggleDisplayButton.title=this.options.strings.hideText):this._container.style.display="block",this._minimized=!1},_onMainMapMoved:function(a){if(this._miniMapMoving)this._miniMapMoving=!1;else{var b=this.options.centerFixed||this._mainMap.getCenter();this._mainMapMoving=!0,this._miniMap.setView(b,this._decideZoom(!0)),this._setDisplay(this._decideMinimized())}this._aimingRect.setBounds(this._mainMap.getBounds())},_onMainMapMoving:function(a){this._aimingRect.setBounds(this._mainMap.getBounds())},_isZoomLevelFixed:function(){var a=this.options.zoomLevelFixed;return this._isDefined(a)&&this._isInteger(a)},_decideZoom:function(a){if(this._isZoomLevelFixed())return a?this.options.zoomLevelFixed:this._mainMap.getZoom();if(a)return this._mainMap.getZoom()+this.options.zoomLevelOffset;var d,b=this._miniMap.getZoom()-this._mainMap.getZoom(),c=this._miniMap.getZoom()-this.options.zoomLevelOffset;return b>this.options.zoomLevelOffset&&this._mainMap.getZoom()<this._miniMap.getMinZoom()-this.options.zoomLevelOffset?this._miniMap.getZoom()>this._lastMiniMapZoom?(d=this._mainMap.getZoom()+1,this._miniMap.setZoom(this._miniMap.getZoom()-1)):d=this._mainMap.getZoom():d=c,this._lastMiniMapZoom=this._miniMap.getZoom(),d},_decideMinimized:function(){return this._userToggledDisplay?this._minimized:this.options.autoToggleDisplay?!!this._mainMap.getBounds().contains(this._miniMap.getBounds()):this._minimized},_isInteger:function(a){return"number"==typeof a},_isDefined:function(a){return"undefined"!=typeof a}});return a.Map.mergeOptions({miniMapControl:!1}),a.Map.addInitHook(function(){this.options.miniMapControl&&(this.miniMapControl=(new b).addTo(this))}),b},window);
